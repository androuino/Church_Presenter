m2d2.load((e=>{e.dict.set({yes:{en:"YES"},no:{en:"NO"},ok:{en:"OK"},send:{en:"SEND"},cancel:{en:"CANCEL"}})})),m2d2.ready((e=>{const t=new EventSource("/events");var n=null,o=null,i=!1;const a=e("#header"),s=e(".container"),c=e("#mainControl"),l=e("#bubbles"),r=e("#tableSong"),d=e("#songs"),g=e("#live");e("#resizer",{onmousedown:function(e){i=!0,document.body.style.cursor="col-resize"}});document.addEventListener("mousemove",(e=>{if(!i)return;const t=y.getBoundingClientRect(),n=e.clientX-t.left;d.style.flexBasis=`${n}px`,g.style.flexBasis=`calc(100% - ${n}px - 4px)`})),document.addEventListener("mouseup",(()=>{i=!1,document.body.style.cursor="default"}));const p=e("#ulLiveLyrics",{template:{li:{tagName:"li",onclick:function(t){const n=this.dataset.id;this.classList.add("active"),p.items.forEach((t=>{if(n!==t.dataset.id)t.classList.remove("active");else{const n={lyrics:t.text};e.post("/stream",n,(e=>{e.ok&&console.debug("lyrics sent.")}),!0)}}))}}},items:[]}),m=e("#ulSongs",{template:{li:{tagName:"li",pSongTitle:{tagName:"p",id:"pSongTitle",onload:function(e){tippy(this,{content:"Click to view the lyrics",interactive:!1,placement:"top",animation:"scale"})},onclick:function(t){const n=t.target.dataset.id;this.classList.add("active"),u.text=this.text+" song lyrics",u.style.color="#ffee00",e.get("/getsonglyrics/"+n,(e=>{if(e.ok){f.items.clear(),e.data.match(/\$\w[\s\S]*?(?=\$\w|$)/g).forEach((e=>{let t=e.trim();t&&f.items.push({dataset:{id:n},innerHTML:t.replace(/\n/g,"<br>")})})),m.items.forEach((e=>{const t=e.children[0];n===t.dataset.id?this.classList.contains("live")&&(this.style.background="linear-gradient(to right, #ffee00, #3ff53f)"):(t.classList.remove("active"),t.classList.contains("live")?(t.style.color="black",t.style.background="#3ff53f"):(t.style.color="",t.style.background=""))}))}}),!0)}},spanRemove:{tagName:"span",id:"spanRemove",css:"gicon",text:"delete",style:{color:"red"},onload:function(e){tippy(this,{content:"Remove from service",interactive:!1,placement:"top",animation:"scale"})}},spanEdit:{tagName:"span",id:"spanEdit",css:"gicon",text:"edit_document",style:{color:"#3be3c6"},onload:function(e){tippy(this,{content:"Edit on the go",interactive:!1,placement:"top",animation:"scale"})}},spanToLive:{tagName:"span",id:"spanToLive",css:"gicon",text:"play_arrow",style:{color:"#3ff53f"},onload:function(e){tippy(this,{content:"To live",interactive:!1,placement:"top",animation:"scale"})},onclick:function(t){var n=0;m.items.forEach((e=>{const t=e.children[0];this===e.children[3]?(e.children[3],n=t.dataset.id,t.classList.add("live"),t.classList.contains("active")?t.style.background="linear-gradient(to right, #ffee00, #3ff53f)":(t.style.color="black",t.style.background="#3ff53f")):(t.classList.remove("live"),t.classList.contains("active")?t.style.background="#ffee00":(t.style.color="",t.style.background=""))})),e.get("/getsonglyrics/"+n,(e=>{if(e.ok){p.items.clear(),e.data.match(/\$\w[\s\S]*?(?=\$\w|$)/g).forEach((e=>{let t=e.trim();t&&p.items.push({innerHTML:t.replace(/\n/g,"<br>")})}))}}),!0)}}}},items:[],onclick:function(e){if(e.target.id&&e.target.id.startsWith("spanRemove")){const t=e.target.closest("li");this.removeChild(t),u.text="SONG'S LYRICS",f.items.clear()}}}),u=e("#lyricsHeader"),f=e("#lyricsContainer",{template:{li:{tagName:"li",style:{borderBottom:"1px solid white"},ondblclick:function(e){this.contentEditable=!0,this.focus(),this.style.backgroundColor="yellow",this.style.color="black"},onblur:function(t){this.contentEditable=!1,this.style.backgroundColor="",this.style.color="";var n="";f.items.forEach((e=>{n+=e.text+"\n"}));const o={id:this.dataset.id,lyrics:n.trimEnd()};e.post("/saveeditedsong",o,(t=>{t.ok?x[0].show():e.failure("Something's wrong saving your edits.")}),!0)},onkeydown:function(e){"Enter"!==e.key||e.shiftKey||(document.execCommand("insertHTML",!1,"<br><br>"),e.preventDefault())}}},items:[]}),h=e("#tbodySongList",{template:{tr:{tagName:"tr",author:{tagName:"td",css:"author"},songTitle:{tagName:"td",css:"songTitle"},deleteSong:{tagName:"td",css:"deleteSong",span:{tagName:"span",id:"iconDeleteSong",css:"gicon",text:"delete_forever",style:{color:"red"},onload:function(e){tippy(this,{content:"Delete forever",interactive:!1,placement:"top",animation:"scale"})},onclick:function(t){null!=o?e.confirm("Confirmation to delete this song?",(t=>{t&&e.delete("/deletesong/"+o,(t=>{t.ok?(e.success("Song is deleted."),L()):e.failure("Something went wrong.")}),!0)})):e.alert("Please pick a song on the list.")}}},editSong:{tagName:"td",css:"editSong",span:{tagName:"span",id:"iconEditSong",css:"gicon",text:"edit_document",onload:function(e){tippy(this,{content:"Edit",interactive:!1,placement:"top",animation:"scale"})},onclick:function(t){null!=o?E(o):e.alert("Please pick a song on the list.")}}},toService:{tagName:"td",css:"toService",span:{tagName:"span",id:"iconAddToService",css:"gicon",text:"playlist_add",onload:function(e){tippy(this,{content:"Add to service",interactive:!1,placement:"top",animation:"scale"})},onclick:function(t){null!=o?e.get("/getsongtitle/"+o,(e=>{e.ok?(e.title,m.items.push({dataset:{id:o},pSongTitle:{dataset:{id:o},text:e.title}})):console.debug("There's an error getting the song title.")}),!0):e.alert("Please click a song on the list.")}}},onclick:function(e){o=this.dataset.id,n=o,this.classList.add("active"),h.items.forEach((e=>{if(e.dataset.id!=o)e.classList.remove("active"),e.style.background="";else{e.style.background="#ffee00";const t=e.querySelectorAll("td")[1];t&&t.textContent}}))},onmouseover:function(e){o=this.dataset.id}}},items:[]}),y=e(".wrapper",{onload:function(t){e.get("/checksessions",(e=>{e.ok?(s.show=!1,l.show=!1,a.show=!0,c.show=!0,L(),localStorage.setItem("login",!0)):(a.show=!1,c.show=!1,s.show=!0,l.show=!0,localStorage.clear())}),!0)}}),v=e(".form"),w=e("#inputUsername"),k=e("#inputPassword"),b=(e("#loginButton",{onclick:function(t){t.preventDefault();const n=w.value,o=k.value;if(""===n||""===o)e.failure("Username or Password cannot be empty!");else{const t={user:n,pass:o};e.post("/login.path",t,(t=>{t.ok?(v.show=!1,y.classList.add("form-success"),localStorage.setItem("login",!0),location.reload()):e.failure("Error: ",t.message)}),!0)}}}),e("#navNew",{onclick:function(e){const t=`${window.location.protocol}/create`;window.open(t,"createWindow","width=800,height=600,toolbar=no,scrollbars=yes,resizable=yes")}}),e("#navEdit",{onclick:function(t){null===n?e.failure("Please select a song to edit."):E(o)}}),e("#navDelete",{onclick:function(t){null===n?e.failure("Please select a song to delete."):e.alert("Deleting...")}}),e("#navInfo",{onclick:function(e){}}),e("#navLogout",{onclick:function(t){e.confirm("Are you want to log out?",(t=>{t&&e.get("/logout.path",(e=>{e.ok&&(a.show=!1,c.show=!1,s.show=!0,l.show=!0,localStorage.clear())}))}))}}),e("#inputSearch",{onkeyup:function(t){let n=this.value.toUpperCase(),o=r.getElementsByTagName("tr");if("Escape"===t.key){this.value="";for(let e=1;e<o.length;e++)o[e].style.display=""}else if(""===n)for(let e=1;e<o.length;e++)o[e].style.display="";else if("Enter"===t.key)if(""===this.value)e.failure("I did not get that!");else for(let e=1;e<o.length;e++){let t=o[e].getElementsByTagName("td"),i="";for(let e=0;e<t.length;e++)i+=t[e].textContent||t[e].innerText;i.toUpperCase().indexOf(n)>-1?o[e].style.display="":o[e].style.display="none"}}})),S=(e("#iconSearch",{onclick:function(t){let n=b.value.toUpperCase(),o=r.getElementsByTagName("tr");if(""===b.value)e.failure("I did not get that!");else for(let e=1;e<o.length;e++){let t=o[e].getElementsByTagName("td"),i="";for(let e=0;e<t.length;e++)i+=t[e].textContent||t[e].innerText;i.toUpperCase().indexOf(n)>-1?o[e].style.display="":o[e].style.display="none"}}}),e("#clearLive",{onclick:function(t){p.items.length>0&&e.confirm("Confirm to clear.",(t=>{t&&(e.post("/liveclear",(e=>{e.ok&&console.debug("Live cleared.")}),(e=>{console.error("Error clearing live.",e)}),!0),p.items.clear(),m.items.forEach((e=>{const t=e.children[0];t.classList.contains("active")?(t.classList.remove("active"),t.classList.contains("live")?(t.style.color="black",t.style.background="#3ff53f"):(t.style.color="",t.style.background="")):t.classList.contains("live")&&(t.classList.remove("live"),t.style.color="",t.style.background="")})))}))}}),e("#controlClearSongList",{onclick:function(t){m.items.length>0&&e.confirm("Confirm to clear the song list?",(e=>{e&&m.items.clear()}))}}),e("#navWiFi",{onclick:function(e){const t=`${window.location.protocol}/wifisettings`;window.open(t,"wifiSettingWindow","width=800,height=400,toolbar=no,scrollbars=yes,resizable=yes")}}));e("#navSettings",{onclick:function(t){e.get("/settings",(e=>{const t=`${window.location.protocol}/settings`;window.open(t,"settingsWindow","width=1200,height=700,toolbar=no,scrollbars=yes,resizable=yes")}),!0)}});function L(){e.get("/getsongs",(e=>{e.ok?(h.items.clear(),e.data.forEach((e=>{h.items.push({dataset:{id:e.id},author:{text:e.author},songTitle:{text:e.songTitle}})}))):console.debug("Error getting all the songs")}))}function E(t){e.get("/editsong/"+t,(e=>{if(e.ok){localStorage.setItem("data",JSON.stringify(e.data));const t=`${window.location.protocol}/create`;window.open(t,"createWindow","width=800,height=600,toolbar=no,scrollbars=yes,resizable=yes")}}))}t.addEventListener("wifi",(function(e){"connected"===JSON.parse(JSON.parse(e.data)).status?S.style.color="green":S.style.color=""}));e("#controlViewLive",{onclick:function(e){const t=`${window.location.protocol}/`;window.open(t,"liveWindow","width=800,height=600,toolbar=no,scrollbars=yes,resizable=yes")}}),e("#controlDefault",{onclick:function(t){e.post("/showlyrics",(e=>{e.ok&&console.debug("lyrics is shown.")}),(e=>{console.error("error showing lyrics.",e)}),!0)}}),e("#controlBlackScreen",{onclick:function(t){e.post("/blackscreen",(e=>{e.ok&&console.debug("black screen activated.")}),(e=>{console.error("error setting screen to black.",e)}),!0)}}),e("#controlHideLyrics",{onclick:function(t){e.post("/hidelyrics",(e=>{e.ok&&console.debug("lyrics is hidden.")}),(e=>{console.error("error hiding lyrics.",e)}),!0)}});tippy("#navNew",{content:"Create a new song",interactive:!0,placement:"right",animation:"scale"}),tippy("#navEdit",{content:"Edit an existing song",interactive:!0,placement:"right",animation:"scale"}),tippy("#navDelete",{content:"Delete a song",interactive:!0,placement:"right",animation:"scale"}),tippy("#navInfo",{allowHTML:!0,content:"About",interactive:!0,placement:"right",animation:"scale"}),tippy("#navWiFi",{content:"Connect the server to a wifi network",interactive:!0,placement:"right",animation:"scale"}),tippy("#navSettings",{content:"Settings",interactive:!0,placement:"right",animation:"scale"}),tippy("#navLogout",{content:"Log out",interactive:!0,placement:"right",animation:"scale"}),tippy("#iconSearch",{content:"Search",interactive:!0,placement:"top",animation:"scale"}),tippy("#lyricsContainer",{content:"Double click to edit",interactive:!1,placement:"top",animation:"scale"}),tippy("#clearLive",{content:"Clear live",interactive:!1,placement:"top",animation:"scale"});const x=tippy("#lyricsContainer",{content:"Save edit success!",interactive:!1,placement:"top",trigger:"manual",animation:"scale"});tippy("#controlDefault",{content:"Default screen",interactive:!1,placement:"top",animation:"scale"}),tippy("#controlBlackScreen",{content:"Set screen to black",interactive:!1,placement:"top",animation:"scale"}),tippy("#controlHideLyrics",{content:"Hide the lyric",interactive:!1,placement:"top",animation:"scale"}),tippy("#controlClearSongList",{content:"Clear song list",interactive:!1,placement:"top",animation:"scale"}),tippy("#controlViewLive",{content:"Live view",interactive:!1,placement:"top",animation:"scale"}),tippy("#controlPreview",{content:"Preview",interactive:!1,placement:"top",animation:"scale"})}));