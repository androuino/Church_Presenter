m2d2.load((t=>{t.dict.set({yes:{en:"YES"},no:{en:"NO"},ok:{en:"OK"},send:{en:"SEND"},cancel:{en:"CANCEL"}})})),m2d2.ready((t=>{const e=new EventSource("/events");var n=null,i=null;const o=t("#header"),a=t(".container"),s=t("#mainControl"),c=t("#bubbles"),l=t("#tableSong"),r=t("#ulLiveLyrics",{template:{li:{tagName:"li",onclick:function(e){const n=this.dataset.id;this.classList.add("active"),r.items.forEach((e=>{if(n!==e.dataset.id)e.classList.remove("active");else{const n={lyrics:e.text};t.post("/stream",n,(t=>{t.ok&&console.debug("lyrics sent.")}),!0)}}))}}},items:[]}),d=t("#ulSongs",{template:{li:{tagName:"li",pSongTitle:{tagName:"p",id:"pSongTitle",onload:function(t){tippy(this,{content:"Click to view the lyrics",interactive:!1,placement:"top",animation:"scale"})},onclick:function(e){const n=e.target.dataset.id;this.classList.add("active"),p.text=this.text+" song lyrics",p.style.color="#ffee00",t.get("/getsonglyrics/"+n,(t=>{if(t.ok){g.items.clear(),t.data.match(/\$\w[\s\S]*?(?=\$\w|$)/g).forEach((t=>{let e=t.trim();e&&g.items.push({dataset:{id:n},innerHTML:e.replace(/\n/g,"<br>")})})),d.items.forEach((t=>{const e=t.children[0];n===e.dataset.id?this.classList.contains("live")&&(this.style.background="linear-gradient(to right, #ffee00, #3ff53f)"):(e.classList.remove("active"),e.classList.contains("live")?(e.style.color="black",e.style.background="#3ff53f"):(e.style.color="",e.style.background=""))}))}}),!0)}},spanRemove:{tagName:"span",id:"spanRemove",css:"gicon",text:"delete",style:{color:"red"},onload:function(t){tippy(this,{content:"Remove from service",interactive:!1,placement:"top",animation:"scale"})}},spanEdit:{tagName:"span",id:"spanEdit",css:"gicon",text:"edit_document",style:{color:"#3be3c6"},onload:function(t){tippy(this,{content:"Edit on the go",interactive:!1,placement:"top",animation:"scale"})}},spanToLive:{tagName:"span",id:"spanToLive",css:"gicon",text:"play_arrow",style:{color:"#3ff53f"},onload:function(t){tippy(this,{content:"To live",interactive:!1,placement:"top",animation:"scale"})},onclick:function(e){var n=0;d.items.forEach((t=>{const e=t.children[0];this===t.children[3]?(t.children[3],n=e.dataset.id,e.classList.add("live"),e.classList.contains("active")?e.style.background="linear-gradient(to right, #ffee00, #3ff53f)":(e.style.color="black",e.style.background="#3ff53f")):(e.classList.remove("live"),e.classList.contains("active")?e.style.background="#ffee00":(e.style.color="",e.style.background=""))})),t.get("/getsonglyrics/"+n,(t=>{if(t.ok){r.items.clear(),t.data.match(/\$\w[\s\S]*?(?=\$\w|$)/g).forEach((t=>{let e=t.trim();e&&r.items.push({innerHTML:e.replace(/\n/g,"<br>")})}))}}),!0)}}}},items:[],onclick:function(t){if(t.target.id&&t.target.id.startsWith("spanRemove")){const e=t.target.closest("li");this.removeChild(e),p.text="SONG'S LYRICS",g.items.clear()}}}),p=t("#lyricsHeader"),g=t("#lyricsContainer",{template:{li:{tagName:"li",style:{borderBottom:"1px solid white"},ondblclick:function(t){this.contentEditable=!0,this.focus(),this.style.backgroundColor="yellow",this.style.color="black"},onblur:function(e){this.contentEditable=!1,this.style.backgroundColor="",this.style.color="";var n="";g.items.forEach((t=>{n+=t.text+"\n"}));const i={id:this.dataset.id,lyrics:n.trimEnd()};t.post("/saveeditedsong",i,(e=>{e.ok?S[0].show():t.failure("Something's wrong saving your edits.")}),!0)},onkeydown:function(t){"Enter"!==t.key||t.shiftKey||(document.execCommand("insertHTML",!1,"<br><br>"),t.preventDefault())}}},items:[]}),m=t("#tbodySongList",{template:{tr:{tagName:"tr",author:{tagName:"td",css:"author"},songTitle:{tagName:"td",css:"songTitle"},deleteSong:{tagName:"td",css:"deleteSong",span:{tagName:"span",id:"iconDeleteSong",css:"gicon",text:"delete_forever",style:{color:"red"},onload:function(t){tippy(this,{content:"Delete forever",interactive:!1,placement:"top",animation:"scale"})},onclick:function(e){null!=i?t.confirm("Confirmation to delete this song?",(e=>{e&&t.delete("/deletesong/"+i,(e=>{e.ok?(t.success("Song is deleted."),k()):t.failure("Something went wrong.")}),!0)})):t.alert("Please pick a song on the list.")}}},editSong:{tagName:"td",css:"editSong",span:{tagName:"span",id:"iconEditSong",css:"gicon",text:"edit_document",onload:function(t){tippy(this,{content:"Edit",interactive:!1,placement:"top",animation:"scale"})},onclick:function(e){null!=i?b(i):t.alert("Please pick a song on the list.")}}},toService:{tagName:"td",css:"toService",span:{tagName:"span",id:"iconAddToService",css:"gicon",text:"playlist_add",onload:function(t){tippy(this,{content:"Add to service",interactive:!1,placement:"top",animation:"scale"})},onclick:function(e){null!=i?t.get("/getsongtitle/"+i,(t=>{t.ok?(t.title,d.items.push({dataset:{id:i},pSongTitle:{dataset:{id:i},text:t.title}})):console.debug("There's an error getting the song title.")}),!0):t.alert("Please click a song on the list.")}}},onclick:function(t){i=this.dataset.id,n=i,this.classList.add("active"),m.items.forEach((t=>{if(t.dataset.id!=i)t.classList.remove("active"),t.style.background="";else{t.style.background="#ffee00";const e=t.querySelectorAll("td")[1];e&&e.textContent}}))},onmouseover:function(t){i=this.dataset.id}}},items:[]}),h=t(".wrapper",{onload:function(e){t.get("/checksessions",(t=>{t.ok?(a.show=!1,c.show=!1,o.show=!0,s.show=!0,k(),localStorage.setItem("login",!0)):(o.show=!1,s.show=!1,a.show=!0,c.show=!0,localStorage.clear())}),!0)}}),f=t(".form"),u=t("#inputUsername"),y=t("#inputPassword"),v=(t("#loginButton",{onclick:function(e){e.preventDefault();const n=u.value,i=y.value;if(""===n||""===i)t.failure("Username or Password cannot be empty!");else{const e={user:n,pass:i};t.post("/login.path",e,(e=>{e.ok?(f.show=!1,h.classList.add("form-success"),localStorage.setItem("login",!0),location.reload()):t.failure("Error: ",e.message)}),!0)}}}),t("#navNew",{onclick:function(t){const e=`${window.location.protocol}/create`;window.open(e,"newWindow","width=800,height=600,toolbar=no,scrollbars=yes,resizable=yes")}}),t("#navEdit",{onclick:function(e){null===n?t.failure("Please select a song to edit."):b(i)}}),t("#navDelete",{onclick:function(e){null===n?t.failure("Please select a song to delete."):t.alert("Deleting...")}}),t("#navInfo",{onclick:function(t){}}),t("#navLogout",{onclick:function(e){t.confirm("Are you want to log out?",(e=>{e&&t.get("/logout.path",(t=>{t.ok&&(o.show=!1,s.show=!1,a.show=!0,c.show=!0,localStorage.clear())}))}))}}),t("#inputSearch",{onkeyup:function(e){let n=this.value.toUpperCase(),i=l.getElementsByTagName("tr");if("Escape"===e.key){this.value="";for(let t=1;t<i.length;t++)i[t].style.display=""}else if(""===n)for(let t=1;t<i.length;t++)i[t].style.display="";else if("Enter"===e.key)if(""===this.value)t.failure("I did not get that!");else for(let t=1;t<i.length;t++){let e=i[t].getElementsByTagName("td"),o="";for(let t=0;t<e.length;t++)o+=e[t].textContent||e[t].innerText;o.toUpperCase().indexOf(n)>-1?i[t].style.display="":i[t].style.display="none"}}})),w=(t("#iconSearch",{onclick:function(e){let n=v.value.toUpperCase(),i=l.getElementsByTagName("tr");if(""===v.value)t.failure("I did not get that!");else for(let t=1;t<i.length;t++){let e=i[t].getElementsByTagName("td"),o="";for(let t=0;t<e.length;t++)o+=e[t].textContent||e[t].innerText;o.toUpperCase().indexOf(n)>-1?i[t].style.display="":i[t].style.display="none"}}}),t("#clearLive",{onclick:function(e){r.items.length>0&&t.confirm("Confirm to clear.",(t=>{t&&(r.items.clear(),d.items.forEach((t=>{const e=t.children[0];e.classList.contains("active")?(e.classList.remove("active"),e.classList.contains("live")?(e.style.color="black",e.style.background="#3ff53f"):(e.style.color="",e.style.background="")):e.classList.contains("live")&&(e.classList.remove("live"),e.style.color="",e.style.background="")})))}))}}),t("#controlClearSongList",{onclick:function(e){d.items.length>0&&t.confirm("Confirm to clear the song list?",(t=>{t&&d.items.clear()}))}}),t("#navWiFi",{onclick:function(t){const e=`${window.location.protocol}/wifisettings`;window.open(e,"newWindow","width=800,height=400,toolbar=no,scrollbars=yes,resizable=yes")}}));t("#navSettings",{onclick:function(e){t.get("/settings",(t=>{const e=`${window.location.protocol}/settings`;window.open(e,"newWindow","width=1200,height=700,toolbar=no,scrollbars=yes,resizable=yes")}),!0)}});function k(){t.get("/getsongs",(t=>{t.ok?(m.items.clear(),t.data.forEach((t=>{m.items.push({dataset:{id:t.id},author:{text:t.author},songTitle:{text:t.songTitle}})}))):console.debug("Error getting all the songs")}))}function b(e){t.get("/editsong/"+e,(t=>{if(t.ok){localStorage.setItem("data",JSON.stringify(t.data));const e=`${window.location.protocol}/create`;window.open(e,"newWindow","width=800,height=600,toolbar=no,scrollbars=yes,resizable=yes")}}))}e.addEventListener("wifi",(function(t){"connected"===JSON.parse(JSON.parse(t.data)).status?w.style.color="green":w.style.color=""})),tippy("#navNew",{content:"Create a new song",interactive:!0,placement:"right",animation:"scale"}),tippy("#navEdit",{content:"Edit an existing song",interactive:!0,placement:"right",animation:"scale"}),tippy("#navDelete",{content:"Delete a song",interactive:!0,placement:"right",animation:"scale"}),tippy("#navInfo",{allowHTML:!0,content:"About",interactive:!0,placement:"right",animation:"scale"}),tippy("#navWiFi",{content:"Connect the server to a wifi network",interactive:!0,placement:"right",animation:"scale"}),tippy("#navSettings",{content:"Settings",interactive:!0,placement:"right",animation:"scale"}),tippy("#navLogout",{content:"Log out",interactive:!0,placement:"right",animation:"scale"}),tippy("#iconSearch",{content:"Search",interactive:!0,placement:"top",animation:"scale"}),tippy("#lyricsContainer",{content:"Double click to edit",interactive:!1,placement:"top",animation:"scale"}),tippy("#clearLive",{content:"Clear live",interactive:!1,placement:"top",animation:"scale"});const S=tippy("#lyricsContainer",{content:"Save edit success!",interactive:!1,placement:"top",trigger:"manual",animation:"scale"});tippy("#controlDefault",{content:"Default screen",interactive:!1,placement:"top",animation:"scale"}),tippy("#controlBlackScreen",{content:"Set screen to black",interactive:!1,placement:"top",animation:"scale"}),tippy("#controlShowDesktop",{content:"Show desktop",interactive:!1,placement:"top",animation:"scale"}),tippy("#controlHideLyrics",{content:"Hide the lyric",interactive:!1,placement:"top",animation:"scale"}),tippy("#controlClearSongList",{content:"Clear song list",interactive:!1,placement:"top",animation:"scale"}),tippy("#controlViewLive",{content:"Live view",interactive:!1,placement:"top",animation:"scale"}),tippy("#controlPreview",{content:"Preview",interactive:!1,placement:"top",animation:"scale"})}));